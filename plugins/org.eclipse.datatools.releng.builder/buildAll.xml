<project default="main">

	<!--
		Steps
	 	Ant properties available at runtime: 
	
	 - eclipse.pdebuild.scripts: the org.eclipse.eclipse.pdebuild.scripts folder
	 - eclipse.pdebuild.home: the root folder of pde build
	 - eclipse.pdebuild.templates: the  templates folder
	
	-->

	<!--build monitoring information:  e-mail, smtp server, build label-->
	<property file="monitor.properties"/>
	
	<!--location of PDE Build configuration files for builder and packager-->
	<property name="eclipse.build.configs" value="${basedir}/eclipse/buildConfigs" />
	
	<property name="sdkHelper" location="${eclipse.build.configs}/eclipse/helper.xml"/>
	<property name="base.builder" value="${basedir}/../BaseBuilder" />
	
	<!--location of properties file containing last tag used for integration build-->
	<property name="mapTag.properties" value="/home/users/releng/buildTools/eclipse33/mapTag.properties"/>
	
	<!--location of properties file containing last performance reference test information-->
	<property name="ref.properties" value="/home/users/releng/buildTools/eclipse.perf/ref33.properties"/>
	
	<!--location of test update site-->
	<property file="${ref.properties}"/>
	
	<!--default buildDirectory-->
	<property name="buildDirectory" value="${basedir}/../src" />
	
	<!--default location for build output, parent to ${buildId}-->
	<property name="postingDirectory" value="${buildDirectory}" />

        <!--remote sign machine login infomation-->
        <property name="username.sign" value="" />
        <property name="password.sign" value="" />
        <property name="hostname.sign" value="" />
        <property name="home.dir" value="" />
        <property name="sign.dir" value="" />

        <target name="main" depends="init">
		<antcall target="buildDtpSdkAllFeature"/>
		<antcall target="buildDtpEnablementAllFeature"/>
		<ant antfile="${eclipse.build.configs}/../helper.xml" target="verifyCompile" />
		<antcall target="integrateDtpFeatures"/>
                <antcall target="Package"/>
                <antcall target="GenerateUpdateSite"/>
		<!--
                <parallel failonany="false">
                    <antcall target="GenerateCVSChangeLog"/>
                </parallel>
		-->
	</target>

	<target name="init">
		<ant antfile="build.xml" target="init" />
		<property file="${buildDirectory}/label.properties" />
		
		<condition property="fetchTag" value="HEAD">
			<equals arg1="${buildType}" arg2="N" />
		</condition>
		<condition property="forceContextQualifier" value="${buildId}">
			<equals arg1="${buildType}" arg2="N" />
		</condition>
		<condition property="generateFeatureVersionSuffix" value="false">
			<equals arg1="${buildType}" arg2="N" />
		</condition>
		<!--compiler args-->
		<property name="compilerArg" value="-enableJavadoc -encoding utf-8 -warn:-discouraged,forbidden" />
		<property name="javacSource" value="1.4" />
		<property name="javacTarget" value="1.4" />
		<property name="javacDebugInfo" value="true" />
		<property name="javacFailOnError" value="true" />
		<property name="javacVerbose" value="false" />
		<property name="logExtension" value=".xml" />
		<!--this property required as of Eclipse 3.0 stream builds > 20031126 -->
		<property name="buildingOSGi" value="true" />
		<!--zip args-->
		<property name="zipargs" value="-y -qq" />
		<!--unzip args-->
		<property name="unzipArgs" value="-qq" />
	</target>
	

	<target name="buildDtpEnablementAllFeature">
                <ant antfile="build.xml" dir="${basedir}">
                        <property name="component" value="${eclipse.build.configs}/dtp.enablement.all" />
                </ant>
	</target>

	<target name="buildDtpSdkAllFeature">

		<!-- build dtp sdk feature -->
		<ant antfile="build.xml" dir="${basedir}">
			<property name="component" value="${eclipse.build.configs}/dtp.sdk.all" />
		</ant>

	</target>

	<target name="buildDtpEnablementFeature">
		<ant antfile="build.xml" dir="${basedir}">
			<property name="component" value="${eclipse.build.configs}/dtp.enablement" />
		</ant>
	</target>
	
	<target name="buildUpdateSite" if="updateSite">
		<ant antfile="${eclipse.build.configs}/../helper.xml" target="buildUpdateJars" />
	</target>
	
	<target name="integrateDtpFeatures">

		<property name="tmpsite" value="${buildDirectory}/tmpsite" />
		<mkdir dir="${tmpsite}/new/eclipse/features" />
		<mkdir dir="${tmpsite}/new/eclipse/plugins" />

		<!-- unzip all dtp packages into same directory -->
		<unzip src="${buildDirectory}/${buildId}/dtp-all-${package.version}.zip" dest="${buildDirectory}/tmpsite"/>
		<unzip src="${buildDirectory}/${buildId}/dtp-enablement-all-${package.version}.zip" dest="${buildDirectory}/tmpsite" overwrite="true"/>
                
                <antcall target="SignFeatures"/>

		<unpackUpdateJars site="${tmpsite}/eclipse" output="${tmpsite}/new/eclipse"/>

		<copy todir="${tmpsite}/new/eclipse">
			<fileset dir="${tmpsite}/eclipse" includes="*.html,readme/**" />
		</copy>

	</target>

        <target name="SignFeatures">
           <zip destfile="${tmpsite}/dtpfeatures.zip" basedir="${tmpsite}/eclipse/features"/>
           <echo message="Upload features to signing server ..."/>
           <scp todir="${username.sign}:${password.sign}@${hostname.sign}:${home.dir}" trust="true">
              <fileset dir="${tmpsite}" includes="dtpfeatures.zip"/>
           </scp>
           <echo message="Finish uploading features."/>
           <echo message="Start signing features ..."/>
           <sshexec host="${hostname.sign}" username="${username.sign}" password="${password.sign}" trust="true"
                    command="cd ${sign.dir};cp ${home.dir}/dtpfeatures.zip ./;sign dtpfeatures.zip nomail;"/>
           <sleep minutes="5"/>
           <echo message="Finish signing features."/>
           <echo message="Download signed features from server ..."/>
           <scp localtofile="${tmpsite}/dtpfeatures.sign.zip" trust="true"
                file="${username.sign}:${password.sign}@${hostname.sign}:${sign.dir}/dtpfeatures.zip"/>
           <echo message="Finish downloading signed features."/>
           <unzip src="${tmpsite}/dtpfeatures.sign.zip" dest="${tmpsite}/eclipse/features"/>

        </target>

	<target name="Package">

		<property file="${buildDirectory}/finalPluginsVersions.properties"/>

		<!-- repackage source features and plugins -->
		<copy todir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.sdk.feature.source_${org.eclipse.datatools.sdk.feature.source}/src" overwrite="true" >
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.sqldevtools.results.feature.source_${org.eclipse.datatools.sqldevtools.results.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.sqldevtools.parsers.feature.source_${org.eclipse.datatools.sqldevtools.parsers.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.sqldevtools.feature.source_${org.eclipse.datatools.sqldevtools.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.sqldevtools.ddlgen.feature.source_${org.eclipse.datatools.sqldevtools.ddlgen.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.sqldevtools.ddl.feature.source_${org.eclipse.datatools.sqldevtools.ddl.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.sqldevtools.data.feature.source_${org.eclipse.datatools.sqldevtools.data.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.sqldevtools.sqlbuilder.feature.source_${org.eclipse.datatools.sqldevtools.sqlbuilder.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.modelbase.feature.source_${org.eclipse.datatools.modelbase.feature.source}/src" includes="**"/>
		<!--
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.intro.source_${org.eclipse.datatools.intro.source}/src" includes="**"/>
		-->
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.sybase.feature.source_${org.eclipse.datatools.enablement.sybase.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.sap.feature.source_${org.eclipse.datatools.enablement.sap.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.postgresql.feature.source_${org.eclipse.datatools.enablement.postgresql.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.oracle.feature.source_${org.eclipse.datatools.enablement.oracle.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.oda.feature.source_${org.eclipse.datatools.enablement.oda.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.oda.designer.feature.source_${org.eclipse.datatools.enablement.oda.designer.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.mysql.feature.source_${org.eclipse.datatools.enablement.mysql.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.msft.feature.source_${org.eclipse.datatools.enablement.msft.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.jdt.feature.source_${org.eclipse.datatools.enablement.jdt.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.jdbc.feature.source_${org.eclipse.datatools.enablement.jdbc.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.ibm.feature.source_${org.eclipse.datatools.enablement.ibm.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.hsqldb.feature.source_${org.eclipse.datatools.enablement.hsqldb.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.feature.source_${org.eclipse.datatools.enablement.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.enablement.apache.derby.feature.source_${org.eclipse.datatools.enablement.apache.derby.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.connectivity.oda.feature.source_${org.eclipse.datatools.connectivity.oda.feature.source}/src" includes="**"/>
		    <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.connectivity.feature.source_${org.eclipse.datatools.connectivity.feature.source}/src" includes="**"/>
            <fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins/org.eclipse.datatools.connectivity.oda.designer.feature.source_${org.eclipse.datatools.connectivity.oda.designer.feature.source}/src" includes="**"/>
		</copy>

		<delete includeemptydirs="true">
			<fileset dir="${buildDirectory}/tmpsite/eclipse/features">
				<include name="*.feature.source_*/**"/>
				<include name="org.eclipse.datatools.intro.source_*/**"/>
				<include name="org.eclipse.datatools.enablement-all.feature_*/**"/>
				<include name="org.eclipse.datatools.sdk-all.feature_*/**"/>
				<exclude name="*.sdk.feature.source*/**"/>
			</fileset>
			<fileset dir="${buildDirectory}/tmpsite/new/eclipse/features">
				<include name="*.feature.source_*/**"/>
				<include name="org.eclipse.datatools.intro.source_*/**"/>
				<include name="org.eclipse.datatools.enablement-all.feature_*/**"/>
				<include name="org.eclipse.datatools.sdk-all.feature_*/**"/>
				<exclude name="*.sdk.feature.source*/**"/>
			</fileset>
			<fileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins">
				<include name="*.feature.source_*/**"/>
				<include name="org.eclipse.datatools.intro.source_*/**"/>
				<exclude name="*.sdk.feature.source*/**"/>
			</fileset>
		</delete>

		<!-- package sdk package -->
		<zip destfile="${buildDirectory}/${buildId}/dtp-sdk-${package.version}.zip" basedir="${buildDirectory}/tmpsite/new" />

		<!-- package non-sdk package -->
		<zip destfile="${buildDirectory}/${buildId}/dtp-${package.version}.zip">
			<zipfileset dir="${buildDirectory}/tmpsite/new/eclipse/features" prefix="eclipse/features">
				<include name="**"/>
				<exclude name="*sdk.feature*/**"/>
			</zipfileset>
			<zipfileset dir="${buildDirectory}/tmpsite/new/eclipse/plugins" prefix="eclipse/plugins">
				<include name="**"/>
				<exclude name="*.source_*/**"/>
				<exclude name="org.eclipse.datatools.doc.isv_*.jar"/>
				<exclude name="org.eclipse.datatools.connectivity.ui.templates_*.jar"/>
			</zipfileset>
			<zipfileset dir="${buildDirectory}/tmpsite/new/eclipse" prefix="eclipse">
				<include name="readme/**"/>
				<include name="*.html"/>
			</zipfileset>
		</zip>

		<!-- copy to output directory -->
		<mkdir dir="${postingDirectory}/${buildId}" />
		<copy file="${buildDirectory}/${buildId}/dtp-sdk-${package.version}.zip" todir="${postingDirectory}/${buildId}"/>
		<copy file="${buildDirectory}/${buildId}/dtp-${package.version}.zip" todir="${postingDirectory}/${buildId}"/>
		<copy file="${buildDirectory}/directory.txt" todir="${postingDirectory}/${buildId}"/>
		<copy tofile="${postingDirectory}/monitor.properties" file="monitor.properties" overwrite="true" />
                <copy file="adb.log" todir="${postingDirectory}/${buildId}"/>
	</target>

	<target name="GenerateUpdateSite">

		<property file="${buildDirectory}/finalFeaturesVersions.properties"/>
		<mkdir dir="${postingDirectory}/${buildId}/UpdateSite"/>

                <!-- replace the feature version in site.xml -->
		        <copy file="${eclipse.build.configs}/../../extras/site.xml" tofile="${buildDirectory}/site.xml" overwrite="true"/>
                <replace file="${buildDirectory}/site.xml" value="1.6.2M2" token="@RELEASE.VERSION@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.connectivity.feature}" token="@org.eclipse.datatools.connectivity.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.connectivity.oda.designer.feature}" token="@org.eclipse.datatools.connectivity.oda.designer.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.connectivity.oda.feature}" token="@org.eclipse.datatools.connectivity.oda.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.doc.user}" token="@org.eclipse.datatools.doc.user@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.common.doc.user}" token="@org.eclipse.datatools.common.doc.user@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.connectivity.doc.user}" token="@org.eclipse.datatools.connectivity.doc.user@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.sqltools.doc.user}" token="@org.eclipse.datatools.sqltools.doc.user@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.apache.derby.feature}" token="@org.eclipse.datatools.enablement.apache.derby.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.feature}" token="@org.eclipse.datatools.enablement.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.hsqldb.feature}" token="@org.eclipse.datatools.enablement.hsqldb.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.ibm.feature}" token="@org.eclipse.datatools.enablement.ibm.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.jdbc.feature}" token="@org.eclipse.datatools.enablement.jdbc.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.jdt.feature}" token="@org.eclipse.datatools.enablement.jdt.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.msft.feature}" token="@org.eclipse.datatools.enablement.msft.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.mysql.feature}" token="@org.eclipse.datatools.enablement.mysql.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.oda.designer.feature}" token="@org.eclipse.datatools.enablement.oda.designer.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.oda.feature}" token="@org.eclipse.datatools.enablement.oda.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.oracle.feature}" token="@org.eclipse.datatools.enablement.oracle.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.postgresql.feature}" token="@org.eclipse.datatools.enablement.postgresql.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.sap.feature}" token="@org.eclipse.datatools.enablement.sap.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.enablement.sybase.feature}" token="@org.eclipse.datatools.enablement.sybase.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.intro}" token="@org.eclipse.datatools.intro@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.modelbase.feature}" token="@org.eclipse.datatools.modelbase.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.sdk.feature}" token="@org.eclipse.datatools.sdk.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.sqldevtools.data.feature}" token="@org.eclipse.datatools.sqldevtools.data.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.sqldevtools.ddl.feature}" token="@org.eclipse.datatools.sqldevtools.ddl.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.sqldevtools.ddlgen.feature}" token="@org.eclipse.datatools.sqldevtools.ddlgen.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.sqldevtools.feature}" token="@org.eclipse.datatools.sqldevtools.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.sqldevtools.parsers.feature}" token="@org.eclipse.datatools.sqldevtools.parsers.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.sqldevtools.results.feature}" token="@org.eclipse.datatools.sqldevtools.results.feature@"/>
                <replace file="${buildDirectory}/site.xml" value="${org.eclipse.datatools.sqldevtools.sqlbuilder.feature}" token="@org.eclipse.datatools.sqldevtools.sqlbuilder.feature@"/>

		<!-- generate dtp.sc for Ganymede update site -->
		<copy file="${eclipse.build.configs}/../../extras/dtp.sc.template" tofile="${buildDirectory}/dtp.sc"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.connectivity.feature}" token="@org.eclipse.datatools.connectivity.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.connectivity.oda.designer.feature}" token="@org.eclipse.datatools.connectivity.oda.designer.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.connectivity.oda.feature}" token="@org.eclipse.datatools.connectivity.oda.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.doc.user}" token="@org.eclipse.datatools.doc.user@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.common.doc.user}" token="@org.eclipse.datatools.common.doc.user@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.sqltools.doc.user}" token="@org.eclipse.datatools.sqltools.doc.user@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.connectivity.doc.user}" token="@org.eclipse.datatools.connectivity.doc.user@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.apache.derby.feature}" token="@org.eclipse.datatools.enablement.apache.derby.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.feature}" token="@org.eclipse.datatools.enablement.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.hsqldb.feature}" token="@org.eclipse.datatools.enablement.hsqldb.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.ibm.feature}" token="@org.eclipse.datatools.enablement.ibm.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.jdbc.feature}" token="@org.eclipse.datatools.enablement.jdbc.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.jdt.feature}" token="@org.eclipse.datatools.enablement.jdt.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.msft.feature}" token="@org.eclipse.datatools.enablement.msft.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.mysql.feature}" token="@org.eclipse.datatools.enablement.mysql.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.oda.designer.feature}" token="@org.eclipse.datatools.enablement.oda.designer.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.oda.feature}" token="@org.eclipse.datatools.enablement.oda.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.oracle.feature}" token="@org.eclipse.datatools.enablement.oracle.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.postgresql.feature}" token="@org.eclipse.datatools.enablement.postgresql.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.sap.feature}" token="@org.eclipse.datatools.enablement.sap.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.enablement.sybase.feature}" token="@org.eclipse.datatools.enablement.sybase.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.intro}" token="@org.eclipse.datatools.intro@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.modelbase.feature}" token="@org.eclipse.datatools.modelbase.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.sdk.feature}" token="@org.eclipse.datatools.sdk.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.sqldevtools.data.feature}" token="@org.eclipse.datatools.sqldevtools.data.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.sqldevtools.ddl.feature}" token="@org.eclipse.datatools.sqldevtools.ddl.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.sqldevtools.ddlgen.feature}" token="@org.eclipse.datatools.sqldevtools.ddlgen.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.sqldevtools.feature}" token="@org.eclipse.datatools.sqldevtools.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.sqldevtools.parsers.feature}" token="@org.eclipse.datatools.sqldevtools.parsers.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.sqldevtools.results.feature}" token="@org.eclipse.datatools.sqldevtools.results.feature@"/>
                <replace file="${buildDirectory}/dtp.sc" value="${org.eclipse.datatools.sqldevtools.sqlbuilder.feature}" token="@org.eclipse.datatools.sqldevtools.sqlbuilder.feature@"/>

                <!-- push update site to output directory -->
                <unzip src="${buildDirectory}/${buildId}/dtp-all-${package.version}.zip" dest="${postingDirectory}/${buildId}/UpdateSite"/>
                <unzip src="${buildDirectory}/${buildId}/dtp-enablement-all-${package.version}.zip" dest="${postingDirectory}/${buildId}/UpdateSite" overwrite="true"/>

		<delete includeemptydirs="true">
			<fileset dir="${postingDirectory}/${buildId}/UpdateSite/eclipse/features">
				<include name="*.feature.source_*/**"/>
				<include name="org.eclipse.datatools.intro.source_*/**"/>
				<include name="org.eclipse.datatools.enablement-all.feature_*/**"/>
				<include name="org.eclipse.datatools.sdk-all.feature_*/**"/>
				<exclude name="*.sdk.feature.source*/**"/>
			</fileset>
                        <fileset dir="${postingDirectory}/${buildId}/UpdateSite/eclipse/plugins">
                                <include name="*.feature.source_*/**"/>
                                <include name="org.eclipse.datatools.intro.source_*/**"/>
                                <exclude name="*.sdk.feature.source*/**"/>
                        </fileset>
                        <fileset dir="${postingDirectory}/${buildId}/UpdateSite/eclipse">
                                <include name="readme/**"/>
                                <include name="*.html"/>
			</fileset>
                </delete>

                <copy todir="${postingDirectory}/${buildId}/UpdateSite">
			<fileset dir="${buildDirectory}">
				<include name="site.xml"/>
				<include name="dtp.sc"/>
			</fileset>
                </copy>

	</target>

	<target name="GenerateCVSChangeLog">
		<ant antfile="${eclipse.build.configs}/../../extras/cvschanges.xml"/>
	</target>

</project>
